# Проект 7-го спринта

### Описание
Репозиторий предназначен для сдачи проекта 7-го спринта
Приложение формирует рекомендации из списка пользователей социальной сети, которые состоят в одном канале с пользователем,
раньше никогда не переписывались и находятся не дальше 1 км друг от друга.
А также позволяет команде исследователей изучить аудиторию соцсети для монетизации с помощью геоаналитики:
	- определяет, где находится большинство пользователей по количеству сообщений, лайков и подписок из одной точки
	- позволяет посмотреть, в какой точке Австралии регистрируется больше всего новых пользователей
	- определяет, как часто пользователи путешествуют и какие города выбирают
для создания системы рекомендации подходящих услуг компаний-партнёров. 

Приложение готовит крупную тестовую выборку и формирует на основании выборки 3 витрины, перечисленным выше задачам

### Структура репозитория
Внутри `src` расположены две папки:
- `/src/dags` - с дагом main.py;
- `/src/scripts` - с модулями для загрузки данных и формирования витрин.

### Шаги/ход исследования
- Сформирован модуль download_data.py для формирования тестовой выборки из общего объема данных
  Поскольку данные объемны, для выполнения проекта отобраны записи за последние 100 дней
  На этом же этапе выполняется преобразование координат к радианам
- Подготовлен модуль для формирования первой витрины с данными о месте нахождения пользователей
  модуль представлен функциями:
     homecity_finder - определяет города постоянного проживания на геолокаций исходящих сообщений.
      городом постоянного проживания считается город из которого отправлен непрерывнй ряд сообщений из 26 дней  
     actual_home_finder - определяет города фактического нахождения по городу последнего сообщения.
     travel_cities - определяет список всех посещенных городов
     first_view_maker - собирает данных из всех функций модуля
- Подготовлен модуль для формирования второй витрины с количеством сообщений, реакций, подписок, регистраций за неделю и за месяц в разрезе городов.
  В модуле данные подготавливаются функциями month_data и week_data за месяц и за неделю соответственно и собираются функцией second_view_maker
- Подготовлен модуль для формирования системы рекомендаций предложения новых друзей
  Функцией all_subscribers_area отбираются люди с геоданным сообщений в пределах 1 км
  Функцией non_chatting_users отбираются пользователи, которые не отрпаляли и не получали сообщения друго от друга
  Результаты обработки данных обеими функциями объединяются через third_view_maker
- Созданные модули обрабатывают данные в ДАГе файла main.py: сперва формируется тестовая выборка(опционально), 
  производится чтение данных из стейджа, из полученных данных формируются витрины
- Переиспользуемые функции, не относящиеся непосредствено к формированию витрины, вынесены в модуль functional.py

### Инструменты
Python, Pyspark, Airflow, DataLake

### Выводы
Выполнен код формирования витрин для создания системы рекомендаций и будущей монетизации социальной сети
